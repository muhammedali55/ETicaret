<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Chat</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>
    <link rel="stylesheet" href="onlinechat.css">
</head>
<body>
      <div class="container-fluid h-100">
        <div class="row justify-content-center h-100">
            
            <div class="col-md-4 col-xl-3 chat"><div class="card mb-sm-3 mb-md-0 contacts_card">


                <div class="input-group">
                    
                    <input type="text" id="txtkullaniciadi" class="form-control type_msg" placeholder="Kullanıcı Adı"></input>
                    
                </div>


                <div class="card-header">
                    <div class="input-group">
                        <input type="text" placeholder="Search..." name="" class="form-control search">
                        <div class="input-group-prepend">
                            <span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
                        </div>
                    </div>
                </div>
                <div class="card-body contacts_body">
                    <ui class="contacts">
                    <li class="active">
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img">
                                <span class="online_icon"></span>
                            </div>
                            <div class="user_info">
                                <span>Khalid</span>
                                <p>Kalid is online</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="https://2.bp.blogspot.com/-8ytYF7cfPkQ/WkPe1-rtrcI/AAAAAAAAGqU/FGfTDVgkcIwmOTtjLka51vineFBExJuSACLcBGAs/s320/31.jpg" class="rounded-circle user_img">
                                <span class="online_icon offline"></span>
                            </div>
                            <div class="user_info">
                                <span>Taherah Big</span>
                                <p>Taherah left 7 mins ago</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="https://i.pinimg.com/originals/ac/b9/90/acb990190ca1ddbb9b20db303375bb58.jpg" class="rounded-circle user_img">
                                <span class="online_icon"></span>
                            </div>
                            <div class="user_info">
                                <span>Sami Rafi</span>
                                <p>Sami is online</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="http://profilepicturesdp.com/wp-content/uploads/2018/07/sweet-girl-profile-pictures-9.jpg" class="rounded-circle user_img">
                                <span class="online_icon offline"></span>
                            </div>
                            <div class="user_info">
                                <span>Nargis Hawa</span>
                                <p>Nargis left 30 mins ago</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="https://static.turbosquid.com/Preview/001214/650/2V/boy-cartoon-3D-model_D.jpg" class="rounded-circle user_img">
                                <span class="online_icon offline"></span>
                            </div>
                            <div class="user_info">
                                <span>Rashid Samim</span>
                                <p>Rashid left 50 mins ago</p>
                            </div>
                        </div>
                    </li>
                    </ui>
                </div>
                <div class="card-footer"></div>
            </div></div>
            <div class="col-md-8 col-xl-6 chat">
                <div class="card">
                    <div class="card-header msg_head">
                        <div class="d-flex bd-highlight">
                            <div class="img_cont">
                                <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img">
                                <span class="online_icon"></span>
                            </div>
                            <div class="user_info">
                                <span>Chat with Khalid</span>
                                <p>1767 Messages</p>
                            </div>
                            <div class="video_cam">
                                <span><i class="fas fa-video"></i></span>
                                <span><i class="fas fa-phone"></i></span>
                            </div>
                        </div>
                        <span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span>
                        <div class="action_menu">
                            <ul>
                                <li><i class="fas fa-user-circle"></i> View profile</li>
                                <li><i class="fas fa-users"></i> Add to close friends</li>
                                <li><i class="fas fa-plus"></i> Add to group</li>
                                <li><i class="fas fa-ban"></i> Block</li>
                            </ul>
                        </div>
                    </div>
                    <div id="contentmessage" class="card-body msg_card_body">
                      
                       
                     
                    </div>
                    <script>
                       
                    </script>
                    <div class="card-footer">
                        <div class="input-group">
                            <div class="input-group-append">
                                <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                            </div>
                            <input type="text" id="txtmesaj" onkeydown="if(event.key == 'Enter') { writeUserData('boş');}" name="" class="form-control type_msg" placeholder="Type your message..."></input>
                            <div class="input-group-append">
                                <span class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    	$(document).ready(function(){
$('#action_menu_btn').click(function(){
	$('.action_menu').toggle();
});
	});
</script>

  <!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  
  <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-firestore.js"></script>
    <script>
        // Set the configuration for your app
        // TODO: Replace with your project's config object
        var config = {
            apiKey: "AIzaSyAW4EXh2VBm3rKabcV_80UVjj71NAtDd7I",
            authDomain: "onlinechat-6e072.firebaseapp.com",
            databaseURL: "https://onlinechat-6e072.firebaseio.com/"          
        };
        firebase.initializeApp(config);

        // Get a reference to the database service
        var database = firebase.database();
        var postsize=0;
        function writeUserData(mesaj) {
            var kullaniciadi = document.getElementById('txtkullaniciadi').value;
            var d = new Date();
            var t = d.getTime();   
            mesaj = document.getElementById("txtmesaj").value;            
            firebase.database().ref('users/chat/' + t +"-"+kullaniciadi).set(mesaj);
            firebase.database().ref('pushsize').set(postsize+1);            
            postsize++;
            listele();
            document.getElementById("txtmesaj").value = "";
        }

        var myVar = setInterval(myChange, 500);

        function myChange(){           
           
            firebase.database().ref().once('value').then(function(snapshot) {   
            snapshot.forEach(function(childSnapshot) {
            var childKey = childSnapshot.key;  
            //alert(childKey);         
            var childData = childSnapshot.val();                  
           // alert(childData);
            if(childKey=='pushsize'){
                if(postsize != childData){
                    listele();
                }
                postsize = childData;
            }
             
            });
            });
          
        }

        
        function listele(){
            var div = document.getElementById('contentmessage');
            var kullaniciadi = document.getElementById('txtkullaniciadi').value;
            div.innerHTML = "";
        firebase.database().ref('/users/chat/').once('value').then(function(snapshot) {   
        snapshot.forEach(function(childSnapshot) {
            var childKey = childSnapshot.key;
            var childData = childSnapshot.val();            
            var position = childKey.indexOf('-')+1 ;
            //alert(position);
            if(childKey.substring(position)==kullaniciadi)
            {
                div.innerHTML +="<div class='d-flex justify-content-end mb-4'>"+
                                "<div class='msg_cotainer_send'>"+
                                childData+ 
                                "<span class='msg_time_send'>"+kullaniciadi+"</span>"+
                                "</div>"+
                                "<div class='img_cont_msg'>"+
                                "<img src='https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg' class='rounded-circle user_img_msg'>"+
                                "</div>"+
                                "</div>";
            }
            else
            {
                div.innerHTML +="<div class='d-flex justify-content-start mb-4'>"+
                                "<div class='msg_cotainer_send'>"+
                                childData+ 
                                "<span class='msg_time_send'>"+childKey.substring(position)+"</span>"+
                                "</div>"+
                                "<div class='img_cont_msg'>"+
                                "<img src='https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg' class='rounded-circle user_img_msg'>"+
                                "</div>"+
                                "</div>";
            }
            var objDiv = document.getElementById("contentmessage");
                        objDiv.scrollTop = objDiv.scrollHeight;   
        });
        });
        
        }



    </script>
</body>
</html>